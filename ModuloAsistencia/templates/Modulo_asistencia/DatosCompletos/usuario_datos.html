{% extends "central_user.html" %}
{% load static %}

{% block title %}{{ user.get_full_name }} | Información Completa{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'bootstrap/css/asistencia/css/fullinfo.css' %}">
{% endblock %}

{% block content %}
<div class="container mt-4" style="margin-bottom:100px;">
    <div class="card border-0 shadow-lg">
        <div class="card-header bg-primary text-white border-0 rounded-top-3">
            <div class="d-flex justify-content-between align-items-center">
                <h3 class="h4 mb-0">
                    <i class="bi bi-person-fill me-2"></i>Información Completa de {{ user.get_full_name }}
                </h3>
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exportModal">
                    <i class="fas fa-file-excel me-2"></i>Exportar Pestañas Seleccionadas
                </button>
            </div>
        </div>
        <div class="card-body p-4">
            <!-- Back button -->
            <a href="{% url 'supervisor_home_asistencia' user.vigencia_plan.empresa.id user.vigencia_plan.id %}" 
               class="btn btn-secondary mb-4">
                <i class="fas fa-arrow-left me-2"></i>Volver
            </a>

            <!-- Tabs with horizontal scroll -->
            <div class="nav-pills-container mb-4">
                <ul class="nav nav-pills nav-fill" id="userInfoTab" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" id="usuario-tab" data-bs-toggle="tab" href="#usuario" role="tab">
                            <i class="bi bi-person me-1"></i>Básica
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="perfil-tab" data-bs-toggle="tab" href="#perfil" role="tab">
                            <i class="bi bi-person-lines-fill me-1"></i>Perfil
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="contacto-tab" data-bs-toggle="tab" href="#contacto" role="tab">
                            <i class="bi bi-phone me-1"></i>Contacto
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="info_bancaria-tab" data-bs-toggle="tab" href="#info_bancaria" role="tab">
                            <i class="bi bi-bank me-1"></i>Bancaria
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="info_adicional-tab" data-bs-toggle="tab" href="#info_adicional" role="tab">
                            <i class="bi bi-info-circle me-1"></i>Adicional
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="seguro_cesantia-tab" data-bs-toggle="tab" href="#seguro_cesantia" role="tab">
                            <i class="bi bi-shield me-1"></i>Cesantía
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="prevision-tab" data-bs-toggle="tab" href="#prevision" role="tab">
                            <i class="bi bi-heart-pulse me-1"></i>Previsión
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="otros-tab" data-bs-toggle="tab" href="#otros" role="tab">
                            <i class="bi bi-file-text me-1"></i>Otros
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="antecedentes_conducir-tab" data-bs-toggle="tab" href="#antecedentes_conducir" role="tab">
                            <i class="bi bi-car-front me-1"></i>Licencias
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="nivel_estudios-tab" data-bs-toggle="tab" href="#nivel_estudios" role="tab">
                            <i class="bi bi-book me-1"></i>Estudios
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="info_complementaria-tab" data-bs-toggle="tab" href="#info_complementaria" role="tab">
                            <i class="bi bi-person-plus me-1"></i>Complementaria
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="examenes-tab" data-bs-toggle="tab" href="#examenes" role="tab">
                            <i class="bi bi-clipboard-check me-1"></i>Exámenes
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="grupo_familiar-tab" data-bs-toggle="tab" href="#grupo_familiar" role="tab">
                            <i class="bi bi-people me-1"></i>Familia
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="capacitacion-tab" data-bs-toggle="tab" href="#capacitacion" role="tab">
                            <i class="bi bi-award me-1"></i>Capacitaciones
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="licencias_medicas-tab" data-bs-toggle="tab" href="#licencias_medicas" role="tab">
                            <i class="bi bi-file-medical me-1"></i>Lic. Médicas
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Tab content -->
            <div class="tab-content" id="userInfoTabContent">
                <!-- Basic Information -->
                <div class="tab-pane fade show active" id="usuario" role="tabpanel">
                    <div class="form-card">
                        <form method="post">
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="usuario">
                            <div class="two-column-form">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">RUT</label>
                                            {{ usuario_form.rut }}
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Nombre de usuario</label>
                                            {{ usuario_form.username }}
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Nombres</label>
                                            {{ usuario_form.first_name }}
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Apellidos</label>
                                            {{ usuario_form.last_name }}
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Correo electrónico</label>
                                            {{ usuario_form.email }}
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Celular</label>
                                            {{ usuario_form.celular }}
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Rol</label>
                                            {{ usuario_form.role }}
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Método de registro</label>
                                            {{ usuario_form.metodo_registro_permitido }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Guardar</button>
                        </form>
                    </div>
                </div>

                <!-- User Profile -->
                <div class="tab-pane fade" id="perfil" role="tabpanel">
                    <div class="form-card">
                        <form method="post">
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="perfil">
                            <div class="two-column-form">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Apellido Paterno</label>
                                            {{ perfil_form.apellido_paterno }}
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Fecha de Nacimiento</label>
                                            {{ perfil_form.fecha_nacimiento }}
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Fecha de Contrato</label>
                                            {{ perfil_form.fecha_contrato }}
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Cargo</label>
                                            {{ perfil_form.cargo }}
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Sindicato</label>
                                            {{ perfil_form.sindicato }}
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Apellido Materno</label>
                                            {{ perfil_form.apellido_materno }}
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Nacionalidad</label>
                                            {{ perfil_form.nacionalidad }}
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Fecha de Término</label>
                                            {{ perfil_form.fecha_termino }}
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Tipo de Jornada</label>
                                            {{ perfil_form.tipo_jornada }}
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Fecha Ingreso Sindicato</label>
                                            {{ perfil_form.fecha_ingreso_sindicato }}
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-12">
                                        <div class="mb-3">
                                            <label class="form-label">Observaciones</label>
                                            <div class="textarea-container">
                                                {{ perfil_form.observaciones }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Guardar</button>
                        </form>
                    </div>
                </div>

                <!-- Contact Information -->
                <div class="tab-pane fade" id="contacto" role="tabpanel">
                    <div class="form-card">
                        <form method="post">
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="contacto">
                            <div class="two-column-form">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Dirección</label>
                                            {{ contacto_form.direccion }}
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Número</label>
                                            {{ contacto_form.numero }}
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Teléfono</label>
                                            {{ contacto_form.telefono }}
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Región</label>
                                            {{ contacto_form.region }}
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Departamento</label>
                                            {{ contacto_form.dpto }}
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Celular</label>
                                            {{ contacto_form.celular }}
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Provincia</label>
                                            {{ contacto_form.provincia }}
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Comuna</label>
                                            {{ contacto_form.comuna }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Guardar</button>
                        </form>
                    </div>
                </div>

                <!-- Banking Information -->
                <div class="tab-pane fade" id="info_bancaria" role="tabpanel">
                    <div class="form-card">
                        <form method="post">
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="info_bancaria">
                            <div class="two-column-form">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Banco</label>
                                            {{ info_bancaria_form.banco }}
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Tipo de Cuenta</label>
                                            {{ info_bancaria_form.tipo_cuenta }}
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-12">
                                        <div class="mb-3">
                                            <label class="form-label">Número de Cuenta</label>
                                            {{ info_bancaria_form.numero_cuenta }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Guardar</button>
                        </form>
                    </div>
                </div>

                <!-- Additional Information -->
                <div class="tab-pane fade" id="info_adicional" role="tabpanel">
                    <div class="form-card">
                        <form method="post">
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="info_adicional">
                            <div class="two-column-form">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Fecha Primera Cotización</label>
                                            {{ info_adicional_form.fecha_primera_cotizacion }}
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Meses Anteriores</label>
                                            {{ info_adicional_form.meses_anteriores }}
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Fecha Reconocimiento Vacaciones</label>
                                            {{ info_adicional_form.fecha_reconocimiento_vacaciones }}
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Años Anteriores</label>
                                            {{ info_adicional_form.anos_anteriores }}
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Días Vacaciones Usados</label>
                                            {{ info_adicional_form.dias_vacaciones_usados }}
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Días Vacaciones Anuales</label>
                                            {{ info_adicional_form.dias_vacaciones_anuales }}
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-12">
                                        <div class="mb-3">
                                            <label class="form-label">Ajustes Vacaciones Progresivas</label>
                                            <div class="textarea-container">
                                                {{ info_adicional_form.ajustes_vacaciones_progresivas }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Guardar</button>
                        </form>
                    </div>
                </div>

                <!-- Unemployment Insurance -->
                <div class="tab-pane fade" id="seguro_cesantia" role="tabpanel">
                    <div class="form-card">
                        <form method="post">
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="seguro_cesantia">
                            <div class="two-column-form">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3 form-check">
                                            {{ seguro_cesantia_form.acogido_seguro }}
                                            <label class="form-check-label">Acogido a Seguro de Cesantía</label>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">AFP Recaudadora</label>
                                            {{ seguro_cesantia_form.afp_recaudadora }}
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3 form-check">
                                            {{ seguro_cesantia_form.acogido_seguro_accidentes }}
                                            <label class="form-check-label">Acogido a Seguro de Accidentes</label>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Sueldo Patronal</label>
                                            {{ seguro_cesantia_form.sueldo_patronal }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Guardar</button>
                        </form>
                    </div>
                </div>

                <!-- Pension Information -->
                <div class="tab-pane fade" id="prevision" role="tabpanel">
                    <div class="form-card">
                        <form method="post">
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="prevision">
                            <div class="two-column-form">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Sistema de Salud</label>
                                            {{ prevision_form.salud }}
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Tasa de Cotización</label>
                                            {{ prevision_form.tasa }}
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Régimen Previsional</label>
                                            {{ prevision_form.regimen }}
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">AFP</label>
                                            {{ prevision_form.afp }}
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-12">
                                        <div class="mb-3 form-check">
                                            {{ prevision_form.pensionado }}
                                            <label class="form-check-label">Pensionado</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Guardar</button>
                        </form>
                    </div>
                </div>

                <!-- Other Information -->
                <div class="tab-pane fade" id="otros" role="tabpanel">
                    <div class="form-card">
                        <form method="post">
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="otros">
                            <div class="two-column-form">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Tipo de Discapacidad</label>
                                            {{ otros_form.tipo_discapacidad }}
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Tasa de Indemnización</label>
                                            {{ otros_form.tasa_indemnizacion }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Guardar</button>
                        </form>
                    </div>
                </div>

                <!-- Driving Records - Excel-like list -->
                <div class="tab-pane fade" id="antecedentes_conducir" role="tabpanel">
                    <div class="form-card">
                        <form method="post">
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="antecedentes_conducir">
                            {{ antecedentes_conducir_formset.management_form }}
                            
                            <div class="table-actions">
                                <button type="button" class="btn btn-add text-white" onclick="addForm('antecedentes_conducir')">
                                    <i class="fas fa-plus me-2"></i>Agregar Licencia
                                </button>
                            </div>
                            
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Tipo Licencia</th>
                                        <th>Municipalidad</th>
                                        <th>Último Control</th>
                                        <th>Vencimiento</th>
                                        <th>Hoja de Vida</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="antecedentes_conducir-forms">
                                    {% for form in antecedentes_conducir_formset %}
                                        <tr>
                                            {{ form.id }}
                                            <td>{{ form.tipo_licencia }}</td>
                                            <td>{{ form.municipalidad }}</td>
                                            <td>{{ form.fecha_ultimo_control }}</td>
                                            <td>{{ form.fecha_vencimiento }}</td>
                                            <td>
                                                <div class="textarea-container">
                                                    {{ form.hoja_vida_conducir }}
                                                </div>
                                            </td>
                                            <td class="actions position-relative" style="text-align: center;">
                                                <span style="display:none;">
                                                    {{ form.DELETE }}
                                                </span>
                                                <button type="button" class="btn btn-danger btn-sm btn-action" onclick="markForDeletion(this, 'antecedentes_conducir')" title="Eliminar">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            
                            <button type="submit" class="btn btn-primary">Guardar</button>
                        </form>
                    </div>
                </div>

                <!-- Education Level - Excel-like list -->
                <div class="tab-pane fade" id="nivel_estudios" role="tabpanel">
                    <div class="form-card">
                        <form method="post">
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="nivel_estudios">
                            {{ nivel_estudios_formset.management_form }}
                            
                            <div class="table-actions">
                                <button type="button" class="btn btn-add text-white" onclick="addForm('nivel_estudios')">
                                    <i class="fas fa-plus me-2"></i>Agregar Nivel
                                </button>
                            </div>
                            
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Nivel de Estudios</th>
                                        <th>Completo</th>
                                        <th>Último Curso</th>
                                        <th>Carrera</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="nivel_estudios-forms">
                                    {% for form in nivel_estudios_formset %}
                                        <tr class="formset-row">
                                            {{ form.id }}
                                            <td>{{ form.nivel_estudios }}</td>
                                            <td>{{ form.completo }}</td>
                                            <td>{{ form.ultimo_curso }}</td>
                                            <td>{{ form.carrera }}</td>
                                            <td class="actions position-relative" style="text-align: center;">
                                                <span style="display:none;">
                                                    {{ form.DELETE }}
                                                </span>
                                                <button type="button" class="btn btn-danger btn-sm btn-action" onclick="markForDeletion(this, 'nivel_estudios')" title="Eliminar">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            
                            <button type="submit" class="btn btn-primary">Guardar</button>
                        </form>
                    </div>
                </div>

                <!-- Complementary Information -->
                <div class="tab-pane fade" id="info_complementaria" role="tabpanel">
                    <div class="form-card">
                        <form method="post">
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="info_complementaria">
                            
                            <button type="submit" name="export_info_complementaria" class="btn btn-export text-white mb-3">
                                <i class="fas fa-file-excel me-2"></i>Exportar
                            </button>
                            
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Campo</th>
                                        <th>Valor</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>País de Origen</td>
                                        <td>{{ info_complementaria_form.pais_origen }}</td>
                                    </tr>
                                    <tr>
                                        <td>Pasaporte</td>
                                        <td>{{ info_complementaria_form.pasaporte }}</td>
                                    </tr>
                                    <tr>
                                        <td>Estado Civil</td>
                                        <td>{{ info_complementaria_form.estado_civil }}</td>
                                    </tr>
                                    <tr>
                                        <td>Tipo de Visa</td>
                                        <td>{{ info_complementaria_form.tipo_visa }}</td>
                                    </tr>
                                    <tr>
                                        <td>Número de Calzado</td>
                                        <td>{{ info_complementaria_form.numero_calzado }}</td>
                                    </tr>
                                    <tr>
                                        <td>Talla de Ropa</td>
                                        <td>{{ info_complementaria_form.talla_ropa }}</td>
                                    </tr>
                                    <tr>
                                        <td>Grupo Sanguíneo</td>
                                        <td>{{ info_complementaria_form.grupo_sanguineo }}</td>
                                    </tr>
                                    <tr>
                                        <td>Alérgico a</td>
                                        <td>
                                            <div class="textarea-container">
                                                {{ info_complementaria_form.alergico }}
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Personal Destacado</td>
                                        <td>{{ info_complementaria_form.personal_destacado }}</td>
                                    </tr>
                                </tbody>
                            </table>
                            
                            <button type="submit" class="btn btn-primary mt-3">Guardar</button>
                        </form>
                    </div>
                </div>

                <!-- Mutual Exams - Excel-like list -->
                <div class="tab-pane fade" id="examenes" role="tabpanel">
                    <div class="form-card">
                        <form method="post">
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="examenes">
                            {{ examenes_formset.management_form }}
                            
                            <div class="table-actions">
                                <button type="button" class="btn btn-add text-white" onclick="addForm('examenes')">
                                    <i class="fas fa-plus me-2"></i>Agregar Examen
                                </button>
                                <button type="submit" name="export_examenes" class="btn btn-export text-white">
                                    <i class="fas fa-file-excel me-2"></i>Exportar
                                </button>
                            </div>
                            
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Tipo de Examen</th>
                                        <th>Fecha de Examen</th>
                                        <th>Fecha de Vencimiento</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="examenes-forms">
                                    {% for form in examenes_formset %}
                                        <tr>
                                            {{ form.id }}
                                            <td>{{ form.tipo_examen }}</td>
                                            <td>{{ form.fecha_examen }}</td>
                                            <td>{{ form.fecha_vencimiento }}</td>
                                            <td class="actions position-relative" style="text-align: center;">
                                                <span style="display:none;">
                                                    {{ form.DELETE }}
                                                </span>
                                                <button type="button" class="btn btn-danger btn-sm btn-action" onclick="markForDeletion(this, 'examenes')" title="Eliminar">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            
                            <button type="submit" class="btn btn-primary">Guardar</button>
                        </form>
                    </div>
                </div>

                <!-- Family Group - Excel-like list -->
                <div class="tab-pane fade" id="grupo_familiar" role="tabpanel">
                    <div class="form-card">
                        <form method="post">
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="grupo_familiar">
                            {{ grupo_familiar_formset.management_form }}
                            
                            <div class="table-actions">
                                <button type="button" class="btn btn-add text-white" onclick="addForm('grupo_familiar')">
                                    <i class="fas fa-plus me-2"></i>Agregar Familiar
                                </button>
                                <button type="submit" name="export_grupo_familiar" class="btn btn-export text-white">
                                    <i class="fas fa-file-excel me-2"></i>Exportar
                                </button>
                            </div>
                            
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>RUT</th>
                                        <th>Nombre</th>
                                        <th>Fecha Nacimiento</th>
                                        <th>Edad</th>
                                        <th>Sexo</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="grupo_familiar-forms">
                                    {% for form in grupo_familiar_formset %}
                                        <tr>
                                            {{ form.id }}
                                            <td>{{ form.rut_carga }}</td>
                                            <td>{{ form.nombre_carga }}</td>
                                            <td>{{ form.fecha_nacimiento }}</td>
                                            <td>{{ form.edad }}</td>
                                            <td>{{ form.sexo }}</td>
                                            <td class="actions position-relative" style="text-align: center;">
                                                <span style="display:none;">
                                                    {{ form.DELETE }}
                                                </span>
                                                <button type="button" class="btn btn-danger btn-sm btn-action" onclick="markForDeletion(this, 'grupo_familiar')" title="Eliminar">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            
                            <button type="submit" class="btn btn-primary">Guardar</button>
                        </form>
                    </div>
                </div>

                <!-- Training - Excel-like list -->
                <div class="tab-pane fade" id="capacitacion" role="tabpanel">
                    <div class="form-card">
                        <form method="post">
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="capacitacion">
                            {{ capacitacion_formset.management_form }}
                            
                            <div class="table-actions">
                                <button type="button" class="btn btn-add text-white" onclick="addForm('capacitacion')">
                                    <i class="fas fa-plus me-2"></i>Agregar Capacitación
                                </button>
                                <button type="submit" name="export_capacitaciones" class="btn btn-export text-white">
                                    <i class="fas fa-file-excel me-2"></i>Exportar
                                </button>
                            </div>
                            
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Descripción</th>
                                        <th>Horas</th>
                                        <th>Institución</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="capacitacion-forms">
                                    {% for form in capacitacion_formset %}
                                        <tr>
                                            <td>
                                                <div class="textarea-container">
                                                    {{ form.descripcion }}
                                                </div>
                                            </td>
                                            {{ form.id }}
                                            <td>{{ form.horas }}</td>
                                            <td>{{ form.institucion }}</td>
                                            <td class="actions position-relative" style="text-align: center;">
                                                <span style="display:none;">
                                                    {{ form.DELETE }}
                                                </span>
                                                <button type="button" class="btn btn-danger btn-sm btn-action" onclick="markForDeletion(this, 'capacitacion')" title="Eliminar">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            
                            <button type="submit" class="btn btn-primary">Guardar</button>
                        </form>
                    </div>
                </div>

                <!-- Medical Licenses - Excel-like list -->
                <div class="tab-pane fade" id="licencias_medicas" role="tabpanel">
                    <div class="form-card">
                        <form method="post">
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="licencias_medicas">
                            {{ licencias_medicas_formset.management_form }}
                            
                            <div class="table-actions">
                                <button type="button" class="btn btn-add text-white" onclick="addForm('licencias_medicas')">
                                    <i class="fas fa-plus me-2"></i>Agregar Licencia
                                </button>
                            </div>
                            
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Tipo Accidente</th>
                                        <th>Clasificación</th>
                                        <th>Inicio Reposo</th>
                                        <th>Término</th>
                                        <th>Alta</th>
                                        <th>Días Reposo</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="licencias_medicas-forms">
                                    {% for form in licencias_medicas_formset %}
                                        <tr>
                                            {{ form.id }}
                                            <td>{{ form.tipo_accidente }}</td>
                                            <td>{{ form.clasificacion_accidente }}</td>
                                            <td>{{ form.fecha_inicio_reposo }}</td>
                                            <td>{{ form.fecha_termino }}</td>
                                            <td>{{ form.fecha_alta }}</td>
                                            <td>{{ form.dias_reposo }}</td>
                                            <td class="actions position-relative" style="text-align: center;">
                                                <span style="display:none;">
                                                    {{ form.DELETE }}
                                                </span>
                                                <button type="button" class="btn btn-danger btn-sm btn-action" onclick="markForDeletion(this, 'licencias_medicas')" title="Eliminar">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            
                            <button type="submit" class="btn btn-primary">Guardar</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal para seleccionar pestañas -->
<div class="modal fade" id="exportModal" tabindex="-1" aria-labelledby="exportModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exportModalLabel">Seleccionar Pestañas para Exportar</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="exportForm" method="post" action="{% url 'export_selected_tabs' user.id %}">
                    {% csrf_token %}
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="tabs" value="perfil" id="tabPerfil">
                        <label class="form-check-label" for="tabPerfil">Perfil</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="tabs" value="contacto" id="tabContacto">
                        <label class="form-check-label" for="tabContacto">Contacto</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="tabs" value="info_bancaria" id="tabInfoBancaria">
                        <label class="form-check-label" for="tabInfoBancaria">Información Bancaria</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="tabs" value="info_adicional" id="tabInfoAdicional">
                        <label class="form-check-label" for="tabInfoAdicional">Información Adicional</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="tabs" value="seguro_cesantia" id="tabSeguroCesantia">
                        <label class="form-check-label" for="tabSeguroCesantia">Seguro de Cesantía</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="tabs" value="prevision" id="tabPrevision">
                        <label class="form-check-label" for="tabPrevision">Previsión</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="tabs" value="otros" id="tabOtros">
                        <label class="form-check-label" for="tabOtros">Otros</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="tabs" value="antecedentes_conducir" id="tabAntecedentesConducir">
                        <label class="form-check-label" for="tabAntecedentesConducir">Antecedentes de Conducir</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="tabs" value="nivel_estudios" id="tabNivelEstudios">
                        <label class="form-check-label" for="tabNivelEstudios">Nivel de Estudios</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="tabs" value="info_complementaria" id="tabInfoComplementaria">
                        <label class="form-check-label" for="tabInfoComplementaria">Información Complementaria</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="tabs" value="examenes" id="tabExamenes">
                        <label class="form-check-label" for="tabExamenes">Exámenes</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="tabs" value="grupo_familiar" id="tabGrupoFamiliar">
                        <label class="form-check-label" for="tabGrupoFamiliar">Grupo Familiar</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="tabs" value="capacitacion" id="tabCapacitacion">
                        <label class="form-check-label" for="tabCapacitacion">Capacitación</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="tabs" value="licencias_medicas" id="tabLicenciasMedicas">
                        <label class="form-check-label" for="tabLicenciasMedicas">Licencias Médicas</label>
                    </div>
                    <div class="form-check mt-3">
                        <input class="form-check-input" type="checkbox" name="combine" id="combine">
                        <label class="form-check-label" for="combine">Combinar en un solo archivo</label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button type="submit" form="exportForm" class="btn btn-primary">Exportar Seleccionadas</button>
            </div>
        </div>
    </div>
</div>

<script src="{% static 'bootstrap/js/asistencia/js/fullinfo.js' %}"></script>
{% endblock %}